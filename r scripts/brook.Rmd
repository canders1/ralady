---
title: "brook"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stringr)
```

```{r}
text <- readLines("~/scrapy/ralady/sources/brook_out.txt")#read in text
text <- str_trim(text)
nos <- grep("^[0-9] ",text)#remove lines that start with a number but no period
nosend <- grep("^[0-9]*$",text)
nosempty <- grep("^[0-9]* $",text)
empty1 <- grep("^$",text)
empty2 <- grep("^ $",text)
outline <- grep("^ *[0-9]*\\.[0-9]",text)
rm <- union(union(nos,nosend),union(union(nosempty,empty1),union(empty2,outline)))
if(length(rm)>0){
  text <- text[-rm]
}
head(text,100)
subs <- grep("^[a-z]\\.",text)
starts <- grep("^[0-9]*\\.",text)
cands <- union(subs,starts)
cands <- sort(cands)
for(i in 1:length(cands)){
  curr <- cands[i]
  if(i < length(cands)){
    neigh <- cands[i+1]
    if((neigh-curr)>5){
      end <- curr+4
    }
    else{
      if((neigh-curr)>2){
        end <- neigh-1
      }else{
        if((neigh-curr)>1){
          end <- curr+1
        }else{
        end <- curr
        }
      }
    }
    added <- text[curr:end]
    text[curr]<- paste(added, sep=" ", collapse=" ")
  }
}
all <- c(1:length(text))
negs <- setdiff(all,cands)
if(length(negs)>0){
  text <- text[-negs]
}
head(text,100)
```

qs <- grep("^'",text)#Find lines that start with fancy quotes (i.e., translations that got cut)
for(i in 1:length(qs)){
  prev <- qs[i]-1
  text[prev] <- paste(text[prev],text[qs[i]])#reunite quotes with their example sentences
}
text <- text[-qs]
head(text, 200)

ls <- grep("'",text)
newtext<- vector(mode="character", length=length(ls))
for(i in 1:length(ls)){
  newtext[i] <- text[ls[i]]
}
cites <- grep("\\(.*[0-9][0-9][0-9][0-9].*\\)",newtext)#find cites (likely non-zapotec data points)
munro <- grep("\\(.*Munro",newtext)#remove those cited from other Zapotec scholars
nmcites <- setdiff(cites,munro)
newtext <- newtext[-nmcites]
secs <- grep("^[0-9]+\\.[0-9]+",newtext)#remove section headings with periods
newtext <- newtext[-secs]
secs2 <- grep("^[0-9]+ [aA-zZ]",newtext)#remove section headings without periods
newtext <- newtext[-secs2]
ungrammatical <- grep("\\*",newtext)#remove ungrammatical sentences
newtext <- newtext[-ungrammatical]
infelicitious <- grep("\\#",newtext)#remove infelicitious sentences
newtext <- newtext[-infelicitious]
splitt <- data.frame(Zap= character(0), Gloss=character(0), Trans=character(0),stringsAsFactors=FALSE)#create a dataframe
for(i in 1:length(newtext)){
  t <- newtext[i]
  t <- stringr::str_replace_all(t,"[0-9]*\\.", "")#remove numbering
  lines <- stringr::str_split(t, "“")#split the translation off
  lines[[1]] <-  stringr::str_replace_all(lines[[1]],"[\\[\\]\n\",”]","")#clean up punctuation
  lines[[1]] <- str_trim(lines[[1]])#trim trailing whitespace
  trans <- lines[[1]][[2]]
  z <- stringr::str_split(lines[[1]][[1]]," ")#split data/gloss on whitespace
  indexes <- which(z == "")
  if(length(indexes)>0){
    z <- z[-indexes]
  }
  if(length(z)>0){#if there's more than 1 word, assume there is a gloss
    length <- length(z[[1]])#calculate starting point of gloss
    half <- length/2
    zap <- paste(z[[1]][-(half+1:length)],collapse = " ")
    gloss <- paste(z[[1]][-(1:half)],collapse = " ")
  }else{
    zap<- ""
    gloss <- ""
  }
  splitt[i,] <- rbind(zap,gloss,trans)
}
```